var Me=Object.defineProperty;var ke=(a,e,t)=>e in a?Me(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var W=(a,e,t)=>ke(a,typeof e!="symbol"?e+"":e,t);import{r as d,bw as Qe,j as s,k as Le,bx as Ae,by as pe,bz as Fe,br as qe,bt as Oe,bs as Pe,bu as De,bq as V,bA as he,bB as z,u as R,a as j,bC as ee,bD as je,bE as te,bF as ve,bG as xe,bH as ye,bI as be}from"./react-vendor-ZT4qGmQJ.js";import{u as Ne,B as f,N as Ue,S as Ke,d as Re,e as ze,b as H,a as B,D as re,f as ie,g as oe,h as ce,i as le,C as de,j as Te,k as $e,c as ue,F as Be,l as _,m as Y,n as J,o as X,I as fe,p as we}from"./admin-dashboard-D0amimT5.js";import{Q as Ge,b as Se,d as se,z as w}from"./vendor-CRHJa4Zq.js";import{u as He}from"./admin-orders-DlVxODts.js";const We=()=>"https://api.eazmenu.com/api",Ce={baseURL:We(),timeout:{admin:15e3}},Ve={admin:{"Content-Type":"application/json","X-Client-Type":"admin"}},Z=768;function _e(){const[a,e]=d.useState(!1);return d.useEffect(()=>{if(typeof window<"u"){const t=window.matchMedia(`(max-width: ${Z-1}px)`),n=()=>{e(window.innerWidth<Z)};return t.addEventListener("change",n),e(window.innerWidth<Z),()=>t.removeEventListener("change",n)}},[]),a}function pt({children:a,activeTab:e="dashboard"}){const{user:t,logoutMutation:n}=Ne(),u=Qe(),c=_e(),[i,m]=d.useState(!1),g=[{id:"dashboard",name:"Dashboard",icon:Fe,path:"/admin/dashboard"},{id:"menu-builder",name:"Menu",icon:qe,path:"/admin/menu-builder"},{id:"table-management",name:"Tables",icon:Oe,path:"/admin/table-management"},{id:"orders",name:"Orders",icon:Pe,path:"/admin/orders"},{id:"translations",name:"Translations",icon:De,path:"/admin/translations"}],y=()=>{n.mutate(),u.navigate({to:"/auth"})},M=()=>{window.history.length>1?window.history.back():u.navigate({to:"/admin/dashboard"})},T=()=>{u.navigate({to:"/admin/dashboard"})};d.useEffect(()=>{m(!1)},[e]);const C=u.state.location.pathname,$=C!=="/admin/dashboard"&&!["/admin/menu-builder","/admin/table-management","/admin/orders"].includes(C);return s.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[s.jsxs("header",{className:"bg-white dark:bg-card shadow-md flex justify-between items-center p-4 sticky top-0 z-30",children:[s.jsxs("div",{className:"flex items-center space-x-2",children:[$&&s.jsx(f,{variant:"ghost",size:"icon",onClick:M,className:"mr-1",children:s.jsx(Le,{className:"h-5 w-5"})}),!c&&e!=="dashboard"&&s.jsx(f,{variant:"ghost",size:"icon",onClick:T,className:"mr-1",children:s.jsx(Ae,{className:"h-5 w-5"})}),s.jsx(pe,{className:"text-primary mr-2 h-6 w-6"}),s.jsx("h1",{className:"text-xl font-medium",children:(t==null?void 0:t.restaurantName)??(t==null?void 0:t.username)??"HandPlatter"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx(Ue,{}),c?s.jsxs(Ke,{open:i,onOpenChange:m,children:[s.jsx(Re,{asChild:!0,children:s.jsx(f,{variant:"ghost",size:"icon",children:s.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})})}),s.jsx(ze,{side:"right",children:s.jsxs("div",{className:"flex flex-col h-full py-6",children:[s.jsxs("div",{className:"flex items-center mb-6",children:[s.jsx(pe,{className:"text-primary mr-2 h-6 w-6"}),s.jsx("h2",{className:"text-lg font-medium",children:(t==null?void 0:t.restaurantName)??(t==null?void 0:t.username)??"HandPlatter"})]}),s.jsx("nav",{className:"space-y-2 flex-1",children:g.map(p=>s.jsxs(V,{to:p.path,className:`flex items-center px-3 py-2 rounded-md transition-colors ${e===p.id?"bg-primary/10 text-primary":"hover:bg-primary/5"}`,children:[s.jsx(p.icon,{className:"mr-3 h-5 w-5"}),p.name]},p.id))}),s.jsxs(f,{variant:"outline",className:"mt-auto justify-start",onClick:y,children:[s.jsx(he,{className:"mr-2 h-5 w-5"}),"Logout"]})]})})]}):s.jsxs(f,{onClick:y,variant:"ghost",children:[s.jsx(he,{className:"mr-2 h-5 w-5"}),"Logout"]})]})]}),!c&&s.jsx("div",{className:"bg-white dark:bg-card border-b sticky top-[73px] z-20",children:s.jsx("nav",{className:"container mx-auto flex items-center space-x-1 px-4",children:g.map(p=>s.jsxs(V,{to:p.path,className:`flex items-center px-4 py-3 border-b-2 transition-colors ${e===p.id?"border-primary text-primary":"border-transparent hover:bg-background hover:text-foreground"}`,children:[s.jsx(p.icon,{className:"mr-2 h-4 w-4"}),s.jsx("span",{children:p.name})]},p.id))})}),s.jsx("main",{className:"flex-1 container mx-auto py-6 px-4 mb-16",children:a}),c&&s.jsx("div",{className:"fixed bottom-0 left-0 right-0 bg-background border-t flex justify-between items-center px-2 py-3 z-30 shadow-lg",children:g.map(p=>s.jsxs(V,{to:p.path,className:`flex flex-col items-center justify-center flex-1 px-1 ${e===p.id?"text-primary":"text-muted-foreground"}`,children:[s.jsx(p.icon,{className:"h-5 w-5"}),s.jsx("span",{className:"text-[10px] truncate",children:p.name})]},p.id))})]})}async function Ee(a){if(!a.ok){const e=await a.text()||a.statusText;throw new Error(`${a.status}: ${e}`)}}async function E(a,e,t){const n=await fetch(e,{method:a,headers:t?{"Content-Type":"application/json"}:{},body:t?JSON.stringify(t):void 0,credentials:"include"});return await Ee(n),n}async function ae(a,e,t){return(await E(a,e,t)).json()}const Ye=({on401:a})=>async({queryKey:e})=>{const t=await fetch(e[0],{credentials:"include"});return await Ee(t),await t.json()};new Ge({defaultOptions:{queries:{queryFn:Ye({on401:"throw"}),refetchInterval:!1,refetchOnWindowFocus:!1,staleTime:1/0,retry:!1},mutations:{retry:!1}}});function ht(){const{toast:a}=H(),e=z(),{currentRestaurantId:t}=B(),[n,u]=d.useState(!1),[c,i]=d.useState(1),[m,g]=d.useState({}),{data:y=[],isLoading:M,error:T}=R({queryKey:["/restaurants",t,"languages"],queryFn:async()=>{if(!t)throw new Error("No restaurant selected");return await(await E("GET",`/restaurants/${t}/languages`)).json()},enabled:!!t}),C=j({mutationFn:async r=>{if(!t)throw new Error("No restaurant selected");return await(await E("POST",`/restaurants/${t}/languages`,r)).json()},onSuccess:()=>{a({title:"Success",description:"Language created successfully"}),e.invalidateQueries({queryKey:["/restaurants",t,"languages"]})},onError:r=>{a({title:"Error",description:`Failed to create language: ${r.message}`,variant:"destructive"})}}),$=j({mutationFn:async({id:r,data:h})=>{if(!t)throw new Error("No restaurant selected");return await(await E("PUT",`/restaurants/${t}/languages/${r}`,h)).json()},onSuccess:()=>{a({title:"Success",description:"Language updated successfully"}),e.invalidateQueries({queryKey:["/restaurants",t,"languages"]})},onError:r=>{a({title:"Error",description:`Failed to update language: ${r.message}`,variant:"destructive"})}}),p=j({mutationFn:async r=>{if(!t)throw new Error("No restaurant selected");return await E("DELETE",`/restaurants/${t}/languages/${r}`),r},onSuccess:()=>{a({title:"Success",description:"Language deleted successfully"}),e.invalidateQueries({queryKey:["/restaurants",t,"languages"]})},onError:r=>{a({title:"Error",description:`Failed to delete language: ${r.message}`,variant:"destructive"})}}),I=j({mutationFn:async r=>{if(!t)throw new Error("No restaurant selected");return await(await E("POST",`/restaurants/${t}/translations/menu-items`,r)).json()},onSuccess:r=>{a({title:"Success",description:"Translation created successfully"}),e.invalidateQueries({queryKey:[`/restaurants/${t}/translations/menu-items/${r.menuItemId}`]})},onError:r=>{a({title:"Error",description:`Failed to create translation: ${r.message}`,variant:"destructive"})}}),l=j({mutationFn:async r=>await(await E("POST","/translations/categories",r)).json(),onSuccess:r=>{a({title:"Success",description:"Translation created successfully"}),e.invalidateQueries({queryKey:[`/restaurants/${t}/translations/categories/${r.categoryId}`]})},onError:r=>{a({title:"Error",description:`Failed to create translation: ${r.message}`,variant:"destructive"})}}),v=j({mutationFn:async r=>{u(!0);try{return await(await E("POST","/translations/auto",r)).json()}finally{u(!1)}},onSuccess:r=>{var Q,A;const h=((Q=r.menuItems)==null?void 0:Q.length)??0,x=((A=r.categories)==null?void 0:A.length)??0,b=h+x;a({title:"Auto-translation Complete",description:`Successfully translated ${b} items (${h} menu items, ${x} categories)`}),h>0&&e.invalidateQueries({queryKey:[`/restaurants/${t}/translations/menu-items`]}),x>0&&e.invalidateQueries({queryKey:[`/restaurants/${t}/translations/categories`]})},onError:r=>{a({title:"Translation Error",description:`Failed to auto-translate content: ${r.message}`,variant:"destructive"})}}),N=d.useCallback(async(r,h)=>{try{const x=`/restaurants/${t}/translations/menu-items/${r}${h?`?languageId=${h}`:""}`,b=await fetch(x);return b.ok?await b.json():[]}catch(x){return console.error("Failed to fetch menu item translations:",x),[]}},[t]),S=d.useCallback(async(r,h)=>{try{const x=`/restaurants/${t}/translations/categories/${r}${h?`?languageId=${h}`:""}`,b=await fetch(x);return b.ok?await b.json():[]}catch(x){return console.error("Failed to fetch category translations:",x),[]}},[t]),F=d.useCallback(r=>{i(r),g({})},[]),q=d.useCallback((r,h)=>{t&&e.fetchQuery({queryKey:[`/restaurants/${t}/translations/menu-items/${r}`,{languageId:h}],queryFn:async()=>{try{const x=await fetch(`/restaurants/${t}/translations/menu-items/${r}?languageId=${h}`);if(!x.ok)return[];const b=await x.json();if(b&&b.length>0){const Q=b[0];g(A=>({...A,[`menuItem-${r}`]:{name:Q.name,description:Q.description}}))}return b}catch(x){return console.error("Failed to load menu item translations:",x),[]}}})},[e,t]),P=d.useCallback((r,h)=>{t&&e.fetchQuery({queryKey:[`/restaurants/${t}/translations/categories/${r}`,{languageId:h}],queryFn:async()=>{try{const x=await fetch(`/restaurants/${t}/translations/categories/${r}?languageId=${h}`);if(!x.ok)return[];const b=await x.json();if(b&&b.length>0){const Q=b[0];g(A=>({...A,[`category-${r}`]:{name:Q.name}}))}return b}catch(x){return console.error("Failed to load category translations:",x),[]}}})},[e,t]),D=d.useCallback((r,h,x="")=>{const b=m[r];return b&&b[h]?b[h]:x},[m]),U=d.useMemo(()=>{var r;return((r=y==null?void 0:y.find(h=>h.id===c))==null?void 0:r.code)??"en"},[y,c]),k={hitsOfTheWeek:{en:"Hits of the week",fr:"Les incontournables de la semaine",ar:"أطباق الأسبوع المميزة"},chefSpecial:{en:"Explore our chef's special selections",fr:"Découvrez les sélections spéciales du chef",ar:"استكشف اختيارات الشيف الخاصة"},searchPlaceholder:{en:"Search menu...",fr:"Rechercher dans le menu...",ar:"ابحث في القائمة..."},all:{en:"All",fr:"Tout",ar:"الكل"},featured:{en:"Featured",fr:"À la une",ar:"مميز"},addToCart:{en:"Add to cart",fr:"Ajouter au panier",ar:"أضف إلى السلة"},add:{en:"Add",fr:"Ajouter",ar:"أضف"},yourOrder:{en:"Your Order",fr:"Votre commande",ar:"طلبك"},total:{en:"Total",fr:"Total",ar:"الإجمالي"},tapToExpand:{en:"Tap to expand",fr:"Appuyez pour agrandir",ar:"اضغط للتوسيع"},cartEmpty:{en:"Your cart is empty",fr:"Votre panier est vide",ar:"سلتك فارغة"},cartAddPrompt:{en:"Add items from the menu to get started",fr:"Ajoutez des articles du menu pour commencer",ar:"أضف عناصر من القائمة للبدء"},placeOrder:{en:"Place Order",fr:"Passer la commande",ar:"إرسال الطلب"},processing:{en:"Processing...",fr:"Traitement...",ar:"جارٍ المعالجة..."}},L=d.useCallback(r=>{var h,x;return((h=k[r])==null?void 0:h[U])??((x=k[r])==null?void 0:x.en)??r},[U]);return{languages:y,isLoadingLanguages:M,languagesError:T,isTranslating:n,currentLanguage:c,currentLangCode:U,changeLanguage:F,getTranslation:D,loadMenuItemTranslations:q,loadCategoryTranslations:P,tUI:L,createLanguageMutation:C,updateLanguageMutation:$,deleteLanguageMutation:p,createMenuItemTranslationMutation:I,createCategoryTranslationMutation:l,autoTranslateMutation:v,getMenuItemTranslations:N,getCategoryTranslations:S}}class Je{constructor(){W(this,"client");this.client=Se.create({baseURL:Ce.baseURL,timeout:Ce.timeout.admin,withCredentials:!0,headers:Ve.admin}),this.client.interceptors.response.use(e=>e,e=>{var n;const t=(n=e.response)==null?void 0:n.status;return t===401?typeof window<"u"&&(window.location.href="/auth"):t===403?console.error("Access denied - insufficient permissions"):t&&t>=500&&console.error("Server error:",e.message),Promise.reject(e)})}async getCurrentUser(){return(await this.client.get("/user")).data}async getRestaurants(){return(await this.client.get("/restaurants")).data}async getDashboardStats(e){return(await this.client.get(`/dashboard/${e}`)).data}async getCategories(e){return(await this.client.get(`/categories/${e}`)).data}async createCategory(e,t){return(await this.client.post(`/categories/${e}`,t)).data}async updateCategory(e,t){return(await this.client.put(`/categories/${e}`,t)).data}async deleteCategory(e){await this.client.delete(`/categories/${e}`)}async getMenuItems(e){return(await this.client.get(`/menu-items/${e}`)).data}async createMenuItem(e){return(await this.client.post("/menu-items",e)).data}async updateMenuItem(e,t){return(await this.client.put(`/menu-items/${e}`,t)).data}async deleteMenuItem(e){await this.client.delete(`/menu-items/${e}`)}async getTables(e){return(await this.client.get("/tables",e?{params:{restaurantId:e}}:{})).data}async createTable(e){return(await this.client.post("/tables",e)).data}async updateTable(e,t){return(await this.client.put(`/tables/${e}`,t)).data}async deleteTable(e){await this.client.delete(`/tables/${e}`)}async getTableQrCode(e){return(await this.client.get(`/tables/${e}/qrcode`)).data}async getAllTablesWithQrCodes(e){return(await this.client.get(`/tables/qrcodes/all?restaurantId=${e}`)).data}async getOrders(e){return(await this.client.get("/orders",{params:{restaurantId:e}})).data}async updateOrderStatus(e,t){return(await this.client.put(`/orders/${e}/status`,t)).data}async exportOrders(){return(await this.client.get("/orders/export",{responseType:"text"})).data}async getLanguages(e){return(await this.client.get(`/restaurants/${e}/languages`)).data}async createLanguage(e,t){return(await this.client.post(`/restaurants/${e}/languages`,t)).data}async updateLanguage(e,t,n){return(await this.client.put(`/restaurants/${e}/languages/${t}`,n)).data}async deleteLanguage(e,t){await this.client.delete(`/restaurants/${e}/languages/${t}`)}async getCategoriesLegacy(){return console.warn("getCategoriesLegacy is deprecated. Use getCategories(restaurantId) instead."),(await this.client.get("/categories")).data}async getMenuItemsLegacy(){return console.warn("getMenuItemsLegacy is deprecated. Use getMenuItems(restaurantId) instead."),(await this.client.get("/menu-items")).data}async getTablesLegacy(){return console.warn("getTablesLegacy is deprecated. Use getTables(restaurantId) instead."),(await this.client.get("/tables")).data}async getOrdersLegacy(){return console.warn("getOrdersLegacy is deprecated. Use getOrders(restaurantId) instead."),(await this.client.get("/orders")).data}async getDashboardStatsLegacy(){return console.warn("getDashboardStatsLegacy is deprecated. Use getDashboardStats(restaurantId) instead."),(await this.client.get("/dashboard")).data}}const K=new Je,Xe=w.object({number:w.coerce.number().int().positive("Table number must be positive"),seats:w.coerce.number().int().positive("Seats must be positive"),active:w.boolean().default(!0)});function xt(){const{user:a}=Ne(),{currentRestaurant:e}=B(),{toast:t}=H(),n=z(),[u,c]=d.useState(!1),[i,m]=d.useState(null),[g,y]=d.useState(!1),[M,T]=d.useState(null),[C,$]=d.useState(!1),[p,I]=d.useState([]),{data:l=[],isLoading:v}=R({queryKey:["/tables",e==null?void 0:e.id],queryFn:()=>K.getTables(e==null?void 0:e.id),enabled:!!(e!=null&&e.id)&&!!a}),N=ee({resolver:se(Xe),defaultValues:{number:1,seats:4,active:!0}}),S=j({mutationFn:async o=>{if(!(e!=null&&e.id))throw new Error("No restaurant selected");return K.createTable({...o,restaurantId:e.id})},onSuccess:()=>{t({title:"Success",description:"Table created successfully"}),n.invalidateQueries({queryKey:["/tables",e==null?void 0:e.id]}),c(!1),N.reset()},onError:o=>{t({title:"Error",description:o.message,variant:"destructive"})}}),F=j({mutationFn:async({id:o,data:O})=>K.updateTable(o,O),onSuccess:()=>{t({title:"Success",description:"Table updated successfully"}),n.invalidateQueries({queryKey:["/tables",e==null?void 0:e.id]}),c(!1),m(null)},onError:o=>{t({title:"Error",description:o.message,variant:"destructive"})}}),q=j({mutationFn:async o=>K.deleteTable(o),onSuccess:()=>{t({title:"Success",description:"Table deleted successfully"}),n.invalidateQueries({queryKey:["/tables",e==null?void 0:e.id]})},onError:o=>{t({title:"Error",description:o.message,variant:"destructive"})}}),P=j({mutationFn:async o=>K.getTableQrCode(o),onSuccess:o=>{T(o),y(!0)},onError:o=>{t({title:"Error",description:o.message,variant:"destructive"})}}),D=j({mutationFn:async()=>{if(!(e!=null&&e.id))throw new Error("No restaurant selected");return K.getAllTablesWithQrCodes(e.id)},onSuccess:o=>{I(o),$(!0)},onError:o=>{t({title:"Error",description:o.message,variant:"destructive"})}});return{tables:l,isLoading:v,isDialogOpen:u,editingTable:i,isQrModalOpen:g,selectedTable:M,gettingAllQRCodes:C,allQrCodes:p,form:N,createTableMutation:S,updateTableMutation:F,deleteTableMutation:q,getQrCodeMutation:P,generateAllQrCodesMutation:D,handleSubmit:o=>{i?F.mutate({id:i.id,data:o}):S.mutate(o)},handleEditTable:o=>{m(o),N.reset({number:o.number,seats:o.seats,active:o.active}),c(!0)},handleDeleteTable:o=>{window.confirm("Are you sure you want to delete this table? This action cannot be undone.")&&q.mutate(o)},handleGetQrCode:o=>{P.mutate(o)},handleGenerateAllQrCodes:()=>{D.mutate()},handleAddTable:()=>{m(null);const o=l.length>0?Math.max(...l.map(O=>O.number))+1:1;N.reset({number:o,seats:4,active:!0}),c(!0)},handleCloseDialog:()=>{c(!1),m(null),N.reset()},handleCloseQrModal:()=>{y(!1),T(null)},handleCloseAllQrCodes:()=>{$(!1),I([])},handleDownloadQrCode:(o,O)=>{const G=document.createElement("a");G.href=o,G.download=`table-${O}-qr.png`,document.body.appendChild(G),G.click(),document.body.removeChild(G)},handlePrintAllQrCodes:()=>{t({title:"Print initiated",description:"Opening print dialog for all QR codes"}),window.print()},setIsDialogOpen:c,setEditingTable:m,setIsQrModalOpen:y,setSelectedTable:T,setGettingAllQRCodes:$,setAllQrCodes:I}}function yt({isOpen:a,onClose:e,data:t}){const n=()=>{const c=document.createElement("a");c.href=t.qrCodeBase64,c.download=`table-${t.tableId}-qr.png`,document.body.appendChild(c),c.click(),document.body.removeChild(c)},u=()=>{const c=window.open("","_blank");if(c){const i=String(t.tableId).replace(/[<>&"']/g,""),m=String(t.qrCodeBase64).replace(/[<>&"']/g,""),g=c.document;g.open();const y=g.createElement("html"),M=g.createElement("head"),T=g.createElement("title");T.textContent=`Table ${i} QR Code`;const C=g.createElement("style");C.textContent=`
        body {
          font-family: Arial, sans-serif;
          text-align: center;
          padding: 20px;
        }
        .qr-container {
          margin: 0 auto;
          max-width: 300px;
        }
        img {
          width: 100%;
          height: auto;
        }
        h2 {
          margin-bottom: 10px;
        }
        p {
          color: #666;
          margin-bottom: 20px;
        }
        .restaurant-name {
          font-size: 18px;
          font-weight: bold;
          margin-top: 20px;
        }
      `,M.appendChild(T),M.appendChild(C);const $=g.createElement("body"),p=g.createElement("div");p.className="qr-container";const I=g.createElement("div");I.className="restaurant-name",I.textContent="Restaurant QR Menu";const l=g.createElement("h2");l.textContent=`Table ${i}`;const v=g.createElement("p");v.textContent="Scan to view menu and place orders";const N=g.createElement("img");N.src=m,N.alt=`QR Code for Table ${i}`,p.appendChild(I),p.appendChild(l),p.appendChild(v),p.appendChild(N),$.appendChild(p),y.appendChild(M),y.appendChild($),g.appendChild(y);const S=g.createElement("script");S.textContent=`
        window.onload = function() {
          window.print();
          window.setTimeout(function() {
            window.close();
          }, 500);
        }
      `,$.appendChild(S),g.close()}};if(console.log(t),!(!t.qrCodeBase64||!t.imageUrl))return s.jsx(re,{open:a,onOpenChange:e,children:s.jsxs(ie,{className:"max-w-xs",children:[s.jsx(oe,{children:s.jsxs(ce,{className:"text-center",children:["Table ",t.tableId," QR Code"]})}),s.jsxs("div",{className:"flex flex-col items-center",children:[s.jsx("p",{className:"text-sm text-muted-foreground text-center mb-4",children:"Scan to access the menu"}),s.jsx("div",{className:"bg-white p-4 border border-neutral-200 rounded mb-4",children:s.jsx("img",{src:t.qrCodeBase64,alt:`QR Code for Table ${t.tableId}`,className:"w-48 h-48"})}),s.jsxs("p",{className:"text-xs text-muted-foreground text-center mb-2 max-w-[90%] break-all",children:["URL: ",t.imageUrl]})]}),s.jsxs(le,{className:"flex flex-row gap-2",children:[s.jsx(f,{className:"flex-1",onClick:n,children:"Download"}),s.jsx(f,{className:"flex-1",variant:"outline",onClick:u,children:"Print"})]})]})})}function bt({title:a,onAddTable:e}){return s.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center",children:[s.jsx("h1",{className:"text-lg sm:text-xl font-bold",children:a}),s.jsxs(f,{onClick:e,className:"w-full sm:w-auto",size:"sm",children:[s.jsx(je,{className:"h-4 w-4 mr-2"}),"Add Table"]})]})}function ft({onGenerateAllQrCodes:a,onPrintAllQrCodes:e}){return s.jsxs(de,{children:[s.jsx(Te,{className:"pb-3",children:s.jsx($e,{className:"text-base sm:text-lg",children:"Quick Actions"})}),s.jsxs(ue,{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[s.jsxs(f,{onClick:a,variant:"outline",size:"sm",className:"w-full",children:[s.jsx(te,{className:"h-4 w-4 mr-2"}),s.jsx("span",{className:"hidden xs:inline",children:"Generate All "}),"QR Codes"]}),s.jsxs(f,{onClick:e,variant:"outline",size:"sm",className:"w-full",children:[s.jsx(ve,{className:"h-4 w-4 mr-2"}),s.jsx("span",{className:"hidden xs:inline",children:"Print All "}),"QR Codes"]})]})]})}function Ze({table:a,onGetQrCode:e,onEdit:t,onDelete:n}){return s.jsxs("div",{className:"p-3 sm:p-4",children:[s.jsxs("div",{className:"flex flex-col gap-3 sm:hidden",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx(xe,{className:"h-5 w-5 text-neutral-500 mr-2"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"font-medium",children:["Table ",a.number]}),s.jsxs("div",{className:"text-xs text-neutral-500",children:["Seats: ",a.seats]})]}),s.jsx("div",{className:`px-2 py-1 rounded-full text-xs ${a.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.active?"Active":"Inactive"})]}),s.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[s.jsxs(f,{variant:"default",size:"sm",onClick:()=>e(a.id),className:"text-xs",children:[s.jsx(te,{className:"h-3 w-3 mr-1"}),"QR"]}),s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>t(a),className:"text-xs",children:[s.jsx(ye,{className:"h-3 w-3 mr-1"}),"Edit"]}),s.jsxs(f,{variant:"destructive",size:"sm",onClick:()=>n(a.id),className:"text-xs",children:[s.jsx(be,{className:"h-3 w-3 mr-1"}),"Del"]})]})]}),s.jsxs("div",{className:"hidden sm:flex justify-between items-center",children:[s.jsxs("div",{className:"flex items-center flex-1",children:[s.jsx(xe,{className:"h-5 w-5 text-neutral-500 mr-3"}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"font-medium",children:["Table ",a.number]}),s.jsxs("div",{className:"text-sm text-neutral-500",children:["Seats: ",a.seats]})]}),s.jsx("div",{className:`px-3 py-1 rounded-full text-sm mr-4 ${a.active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.active?"Active":"Inactive"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs(f,{variant:"default",size:"sm",onClick:()=>e(a.id),children:[s.jsx(te,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Generate QR Code"})]}),s.jsxs(f,{variant:"outline",size:"sm",onClick:()=>t(a),children:[s.jsx(ye,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Edit Table"})]}),s.jsxs(f,{variant:"destructive",size:"sm",onClick:()=>n(a.id),children:[s.jsx(be,{className:"h-4 w-4"}),s.jsx("span",{className:"sr-only",children:"Delete Table"})]})]})]})]})}function wt({tables:a,isLoading:e,onAddTable:t,onGetQrCode:n,onEditTable:u,onDeleteTable:c}){return s.jsxs(de,{children:[s.jsx(Te,{className:"pb-3",children:s.jsx($e,{className:"text-base sm:text-lg",children:"Tables"})}),s.jsx(ue,{className:"p-0",children:e?s.jsx("div",{className:"p-4 text-center text-sm text-neutral-500",children:"Loading tables..."}):a.length===0?s.jsxs("div",{className:"p-4 text-center",children:[s.jsx("p",{className:"text-sm text-neutral-600 mb-3",children:"No tables yet. Create your first table to get started."}),s.jsxs(f,{variant:"outline",size:"sm",onClick:t,className:"w-full sm:w-auto",children:[s.jsx(je,{className:"h-4 w-4 mr-2"}),"Add Table"]})]}):s.jsx("div",{className:"divide-y divide-neutral-200",children:a.map(i=>s.jsx(Ze,{table:i,onGetQrCode:n,onEdit:u,onDelete:c},i.id))})})]})}function Ct({isOpen:a,onClose:e,form:t,onSubmit:n,editingTable:u,isLoading:c}){return s.jsx(re,{open:a,onOpenChange:e,children:s.jsxs(ie,{className:"w-[95vw] max-w-md mx-auto",children:[s.jsx(oe,{children:s.jsx(ce,{className:"text-base sm:text-lg",children:u?"Edit Table":"Add Table"})}),s.jsx(Be,{...t,children:s.jsxs("form",{onSubmit:t.handleSubmit(n),className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(_,{control:t.control,name:"number",render:({field:i})=>s.jsxs(Y,{children:[s.jsx(J,{className:"text-sm",children:"Table Number"}),s.jsx(X,{children:s.jsx(fe,{type:"number",...i,className:"h-10",placeholder:"Enter table number"})}),s.jsx(we,{})]})}),s.jsx(_,{control:t.control,name:"seats",render:({field:i})=>s.jsxs(Y,{children:[s.jsx(J,{className:"text-sm",children:"Seats"}),s.jsx(X,{children:s.jsx(fe,{type:"number",...i,className:"h-10",placeholder:"Number of seats"})}),s.jsx(we,{})]})})]}),s.jsx(_,{control:t.control,name:"active",render:({field:i})=>s.jsxs(Y,{className:"flex flex-row items-center gap-3 space-y-0 p-3 border rounded-lg",children:[s.jsx(X,{children:s.jsx("input",{type:"checkbox",checked:i.value,onChange:i.onChange,className:"h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"})}),s.jsxs("div",{className:"flex-1",children:[s.jsx(J,{className:"text-sm font-medium",children:"Table is active"}),s.jsx("p",{className:"text-xs text-neutral-500 mt-1",children:"Active tables can receive orders from customers"})]})]})}),s.jsxs(le,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0",children:[s.jsx(f,{type:"button",variant:"outline",onClick:e,className:"w-full sm:w-auto",children:"Cancel"}),s.jsx(f,{type:"submit",disabled:c,className:"w-full sm:w-auto",children:c?"Saving...":"Save"})]})]})})]})})}function jt({isOpen:a,onClose:e,qrCodes:t,onDownloadQrCode:n,onPrintAllQrCodes:u}){return s.jsx(re,{open:a,onOpenChange:e,children:s.jsxs(ie,{className:"w-[95vw] max-w-4xl max-h-[90vh] flex flex-col",children:[s.jsx(oe,{children:s.jsx(ce,{className:"text-base sm:text-lg",children:"All Table QR Codes"})}),s.jsx("div",{className:"flex-1 overflow-hidden",children:s.jsx("div",{className:"grid grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 sm:gap-4 max-h-[60vh] overflow-y-auto p-1 sm:p-2",children:t.map(c=>s.jsx(de,{className:"overflow-hidden",children:s.jsxs(ue,{className:"p-3 sm:p-4 text-center",children:[s.jsxs("h3",{className:"font-bold mb-2 text-sm sm:text-base",children:["Table ",c.table.number]}),s.jsx("div",{className:"bg-white p-2 mb-2 border rounded",children:s.jsx("img",{src:c.qrCodeBase64,alt:`QR Code for Table ${c.table.number}`,className:"w-full h-auto max-w-[150px] mx-auto"})}),s.jsx(f,{size:"sm",variant:"outline",className:"w-full text-xs sm:text-sm",onClick:()=>n(c.qrCodeBase64,c.table.number),children:"Download"})]})},c.table.id))})}),s.jsxs(le,{className:"flex flex-col-reverse sm:flex-row gap-2 sm:gap-0 pt-4 border-t",children:[s.jsx(f,{variant:"outline",onClick:e,className:"w-full sm:w-auto",children:"Close"}),s.jsxs(f,{onClick:u,className:"w-full sm:w-auto",children:[s.jsx(ve,{className:"h-4 w-4 mr-2"}),"Print All"]})]})]})})}const et="https://api.eazmenu.com/api";class tt{constructor(){W(this,"client");this.client=Se.create({baseURL:et,timeout:1e4,withCredentials:!0,headers:{"Content-Type":"application/json"}}),this.client.interceptors.response.use(e=>e,e=>{var n;const t=(n=e.response)==null?void 0:n.status;return t===401?typeof window<"u"&&(window.location.href="/auth"):t===403?console.error("Access denied - insufficient permissions"):t&&t>=500&&console.error("Server error:",e.message),Promise.reject(e)})}async getCurrentUser(){return(await this.client.get("/user")).data}async getRestaurants(){return(await this.client.get("/restaurants")).data}async getDashboardStats(e){return(await this.client.get(`/dashboard/${e}`)).data}async getCategories(e){return(await this.client.get(`/categories/${e}`)).data}async createCategory(e,t){return(await this.client.post(`/categories/${e}`,t)).data}async updateCategory(e,t){return(await this.client.put(`/categories/${e}`,t)).data}async deleteCategory(e){await this.client.delete(`/categories/${e}`)}async getMenuItems(e){return(await this.client.get(`/menu-items/${e}`)).data}async createMenuItem(e){return(await this.client.post("/menu-items",e)).data}async updateMenuItem(e,t){return(await this.client.put(`/menu-items/${e}`,t)).data}async deleteMenuItem(e){await this.client.delete(`/menu-items/${e}`)}async getTables(e){return(await this.client.get("/tables",{params:{restaurantId:e}})).data}async createTable(e){return(await this.client.post("/tables",e)).data}async updateTable(e,t){return(await this.client.put(`/tables/${e}`,t)).data}async deleteTable(e){await this.client.delete(`/tables/${e}`)}async getOrders(e){return(await this.client.get("/orders",{params:{restaurantId:e}})).data}async updateOrderStatus(e,t){return(await this.client.put(`/orders/${e}/status`,t)).data}async getLanguages(e){return(await this.client.get(`/restaurants/${e}/languages`)).data}async createLanguage(e,t){return(await this.client.post(`/restaurants/${e}/languages`,t)).data}async updateLanguage(e,t,n){return(await this.client.put(`/restaurants/${e}/languages/${t}`,n)).data}async deleteLanguage(e,t){await this.client.delete(`/restaurants/${e}/languages/${t}`)}async getPublicMenu(e,t,n){return(await this.client.get(`/menu/${e}/${t}/${n}`)).data}}const Ie=new tt,st=(a,e)=>({queryKey:[...a],queryFn:e,staleTime:5*60*1e3,gcTime:10*60*1e3,retry:(t,n)=>{var u;return(u=n.response)!=null&&u.status&&n.response.status>=400&&n.response.status<500?!1:t<3}}),ne={user:()=>["user"],restaurants:()=>["restaurants"],dashboard:a=>["dashboard",a],categories:a=>["categories",a],menuItems:a=>["menuItems",a],tables:a=>["tables",a],orders:a=>["orders",a],languages:a=>["languages",a],publicMenu:(a,e,t)=>["publicMenu",a,e,t]},at=a=>R({...st(ne.orders(a),()=>Ie.getOrders(a)),enabled:!!a,refetchInterval:3e4}),nt=()=>{const a=z();return j({mutationFn:({orderId:e,data:t})=>Ie.updateOrderStatus(e,t),onSuccess:e=>{a.invalidateQueries({queryKey:ne.orders(e.restaurantId)}),a.invalidateQueries({queryKey:ne.dashboard(e.restaurantId)})}})};function vt(){const{toast:a}=H(),e=z(),{sendOrderUpdate:t}=He(),{currentRestaurantId:n}=B(),u=at(n??0),c=R({queryKey:["/orders",n],queryFn:()=>n?ae("GET",`/orders?restaurantId=${n}`):Promise.resolve([]),enabled:!!n&&!u.data}),{data:i=[],isLoading:m,refetch:g}=n?u:c,y=nt(),M=j({mutationFn:async({orderId:l,status:v})=>(await E("PUT",`/orders/${l}/status`,{status:v})).json(),onSuccess:l=>{a({title:"Order status updated",description:`Order #${l.orderNumber} is now ${l.status}`}),e.invalidateQueries({queryKey:["/orders"]}),t&&l.tableId&&t(l)},onError:l=>{a({title:"Failed to update order status",description:l.message,variant:"destructive"})}}),T=j({mutationFn:({orderId:l,status:v})=>y.mutateAsync({orderId:l,data:{status:v}}),onSuccess:l=>{a({title:"Order status updated",description:`Order #${l.orderNumber} is now ${l.status}`}),t&&l.tableId&&t(l)},onError:l=>{a({title:"Failed to update order status",description:l.message,variant:"destructive"})}}),C=n?T:M,$=d.useCallback((l,v)=>{C.mutate({orderId:l,status:v})},[C]),p=d.useCallback(async()=>{try{if(!n)throw new Error("No restaurant selected");const l=await fetch(`/orders/export?restaurantId=${n}`);if(!l.ok)throw new Error("Failed to export orders");const v=await l.blob(),N=window.URL.createObjectURL(v),S=document.createElement("a");S.href=N,S.download="orders.csv",document.body.appendChild(S),S.click(),document.body.removeChild(S),window.URL.revokeObjectURL(N),a({title:"Export successful",description:"Orders have been exported as CSV"})}catch(l){a({title:"Export failed",description:l instanceof Error?l.message:"Unknown error",variant:"destructive"})}},[a]),I=d.useCallback(l=>!l||l==="All"?i:i.filter(v=>v.status===l),[i]);return{orders:i,isLoading:m,refetch:g,updateOrderStatus:$,exportOrders:p,filterOrdersByStatus:I,isUpdatingStatus:C.isPending}}w.object({name:w.string().min(2,"Category name must be at least 2 characters"),sortOrder:w.coerce.number().int().nonnegative()});function rt(){const{toast:a}=H(),e=z(),{currentRestaurantId:t}=B(),n=j({mutationFn:async i=>{if(!t)throw new Error("No restaurant selected");return(await E("POST",`/categories/${t}`,i)).json()},onSuccess:()=>{a({title:"Success",description:"Category created successfully"}),e.invalidateQueries({queryKey:["/categories",t]})},onError:i=>{a({title:"Error",description:i.message,variant:"destructive"})}}),u=j({mutationFn:async({id:i,data:m})=>(await E("PUT",`/categories/${i}`,m)).json(),onSuccess:()=>{a({title:"Success",description:"Category updated successfully"}),e.invalidateQueries({queryKey:["/categories",t]})},onError:i=>{a({title:"Error",description:i.message,variant:"destructive"})}}),c=j({mutationFn:async i=>{await E("DELETE",`/categories/${i}`)},onSuccess:()=>{a({title:"Success",description:"Category deleted successfully"}),e.invalidateQueries({queryKey:["/categories",t]})},onError:i=>{a({title:"Error",description:i.message,variant:"destructive"})}});return{createCategory:n.mutate,updateCategory:u.mutate,deleteCategory:c.mutate,isCreating:n.isPending,isUpdating:u.isPending,isDeleting:c.isPending}}w.object({name:w.string().min(2,"Menu item name must be at least 2 characters"),description:w.string().optional(),price:w.coerce.number().min(0,"Price cannot be negative"),categoryId:w.coerce.number().int().positive("Please select a category"),active:w.boolean().default(!0)});function it(){const{toast:a}=H(),e=z(),{currentRestaurantId:t}=B(),n=j({mutationFn:async i=>{const m={...i,price:Math.round(i.price*100)};return(await E("POST","/menu-items",m)).json()},onSuccess:()=>{a({title:"Success",description:"Menu item created successfully"}),e.invalidateQueries({queryKey:["/menu-items",t]})},onError:i=>{a({title:"Error",description:i.message,variant:"destructive"})}}),u=j({mutationFn:async({id:i,data:m})=>{const g={...m,price:Math.round(m.price*100)};return(await E("PUT",`/menu-items/${i}`,g)).json()},onSuccess:()=>{a({title:"Success",description:"Menu item updated successfully"}),e.invalidateQueries({queryKey:["/menu-items",t]})},onError:i=>{a({title:"Error",description:i.message,variant:"destructive"})}}),c=j({mutationFn:async i=>{await E("DELETE",`/menu-items/${i}`)},onSuccess:()=>{a({title:"Success",description:"Menu item deleted successfully"}),e.invalidateQueries({queryKey:["/menu-items",t]})},onError:i=>{a({title:"Error",description:i.message,variant:"destructive"})}});return{createMenuItem:n.mutate,updateMenuItem:u.mutate,deleteMenuItem:c.mutate,isCreating:n.isPending,isUpdating:u.isPending,isDeleting:c.isPending}}const ot=w.object({name:w.string().min(2,"Category name must be at least 2 characters"),sortOrder:w.coerce.number().int().nonnegative()}),ct=w.object({name:w.string().min(2,"Menu item name must be at least 2 characters"),description:w.string().optional(),price:w.coerce.number().min(0,"Price cannot be negative"),categoryId:w.coerce.number().int().positive("Please select a category"),active:w.boolean().default(!0)});function Nt(){const{currentRestaurantId:a}=B(),[e,t]=d.useState(!1),[n,u]=d.useState(!1),[c,i]=d.useState(null),[m,g]=d.useState(null),[y,M]=d.useState(null),{data:T=[]}=R({queryKey:["/categories",a],queryFn:()=>ae("GET",`/categories/${a}`),enabled:!!a}),{data:C=[]}=R({queryKey:["/menu-items",a],queryFn:()=>ae("GET",`/menu-items/${a}`),enabled:!!a}),{createCategory:$,updateCategory:p,deleteCategory:I,isCreating:l,isUpdating:v,isDeleting:N}=rt(),{createMenuItem:S,updateMenuItem:F,deleteMenuItem:q,isCreating:P,isUpdating:D,isDeleting:U}=it(),k=ee({resolver:se(ot),defaultValues:{name:"",sortOrder:0}}),L=ee({resolver:se(ct),defaultValues:{name:"",description:"",price:0,categoryId:0,active:!0}});d.useEffect(()=>{e&&c?k.reset({name:c.name,sortOrder:c.sortOrder}):e&&k.reset({name:"",sortOrder:T.length})},[e,c,k,T]),d.useEffect(()=>{n&&m?L.reset({name:m.name,description:m.description??"",price:m.price/100,categoryId:m.categoryId,active:m.active}):n&&L.reset({name:"",description:"",price:0,categoryId:y??0,active:!0})},[n,m,L,y]);const r=d.useCallback(o=>{i(o),t(!0)},[]),h=d.useCallback(o=>{window.confirm("Are you sure you want to delete this category? This will also delete all menu items in this category.")&&I(o)},[I]),x=d.useCallback(o=>{g(o),u(!0)},[]),b=d.useCallback(o=>{window.confirm("Are you sure you want to delete this menu item?")&&q(o)},[q]),Q=d.useCallback(o=>{c?p({id:c.id,data:o}):$(o),t(!1),i(null),k.reset()},[c,p,$,k]),A=d.useCallback(o=>{m?F({id:m.id,data:o}):S(o),u(!1),g(null),L.reset()},[m,F,S,L]),me=d.useMemo(()=>y?C.filter(o=>o.categoryId===y):C,[y,C]),ge=d.useCallback(o=>C.filter(O=>O.categoryId===o),[C]);return{isCategoryDialogOpen:e,setIsCategoryDialogOpen:t,isMenuItemDialogOpen:n,setIsMenuItemDialogOpen:u,editingCategory:c,setEditingCategory:i,editingMenuItem:m,setEditingMenuItem:g,activeCategory:y,setActiveCategory:M,categories:T,menuItems:C,filteredMenuItems:me,categoryForm:k,menuItemForm:L,handleEditCategory:r,handleDeleteCategory:h,handleEditMenuItem:x,handleDeleteMenuItem:b,onCategorySubmit:Q,onMenuItemSubmit:A,getCategoryItems:ge,isCategoryLoading:l??v??N,isMenuItemLoading:P??D??U}}export{Ce as A,bt as P,ft as Q,wt as T,K as a,xt as b,Ct as c,yt as d,jt as e,ht as f,pt as g,ae as h,_e as i,Nt as j,vt as u};
